# 1장 개발환경

윈도우 드라이버를 처음 공부하는 독자들은 드라이버를 개발하기 위해 무엇을 준비해야 하는지에 대해 무엇보다 잘 알고 있어야 한다.

* 드라이버를 빌드하는 데 사용되는 개발툴과 지원하는 운영체제, 즉 윈도우 버전
* 드라이버를 디버깅하는 방법
* 드라이버를 작성하는 데 도움이 되는 사이트들

이렇게 세 가지를 알아야 한다.
마이크로소프트는 이 세 가지를 모두 DDK(WDK) 개발툴을 통해 개발자에게 제공하고 있다.
개발자는 단지 개발툴만 설치하면 빌드 환경, 디버깅 환경 그리고 참조할 도움말 정보를 모두 얻을 수 있다.
다만 아쉬운 점은 도움말 정보가 있지만 '아는 수준만큼만 정보가 보인다.'는 것이다.
나 역시 지금도 도움말을 참조해도 잘 이해되지 않는 내용이 많다.
이런 까닭에, 처음 드라이버 공부를 시작하는 독자들이 어느 정도로 어려움을 겪게 될지는 불 보듯 뻔하다.

윈도우 드라이버를 잘 작성하려면 무엇보다 윈도우 운영체제를 잘 이해해야 한다.
드라이버가 동작하는 주요 환경이 커널 레벨이라는 점을 감안하면, 윈도우 커널에 대해 더 많이 이해하면 할수록 분명 드라이버 개발이 쉽다.
이런 부분은 시중에서 구할 수 있는 서적들과 DDK(WDK)와 함께 제공되는 도움말 정보를 최대한 이해하면서 공부해야 한다.

다만 드라이버 개발에 있어서 개발툴(WDK)이 제공하는 샘플 소스와 디버깅 환경을 충분히 알고 있는 것은 가장 기본이 되는 전제이므로(또한 가장 중요한 정보다), 독자들은 개발툴을 자신의 것으로 잘 활용해야 한다.

## 1.1 디바이스 드라이버

윈도우에서 운용되는 디바이스 드라이버의 종류는 많다.
이들은 각각 사용될 유형에 따라서 그 종류를 구분할 수 있으며, 플러그 앤 플레이 환경을 사용하는 경우(PNP 드라이버)와 그렇지 않은 경우(레거시 드라이버)로 나눌 수도 있다.

### 1.1.1 기본 설명

디바이스 드라이버는 여러 가지 종류로 나뉜다.
|1|2|3|4|5|
|--|--|--|--|--|
|오디오 디바이스 드라이버|배터리 디바이스 드라이버|블루투스 디바이스 드라이버|디스플레이 디바이스 드라이버|HID 디바이스 드라이버|
|이미징 디바이스 드라이버|파일시스템 디바이스 드라이버|네트워크 디바이스 드라이버|프린터 디바이스 드라이버|센서 디바이스 드라이버|
|스마트카드 리더 디바이스 드라이버|스토리지 디바이스 드라이버|버스 디바이스 드라이버|포트 디바이스 드라이버|적외선 디바이스 드라이버|

꼭 그런 것은 아니지만 사용될 유형에 따라서 드라이버 개발 방법이 서로 다르기 때문에, 한 가지 유형의 드라이버를 개발해본 경험자라고 하더라도 다른 지식의 도움이 없이 이와 다른 유형의 드라이버를 작성하는 것은 어렵다.

### 1.1.2 레거시 드라이버

개발자들 사이에서 레거시 드라이버라는 용어는 여러 가지 의미로 사용되곤 한다.
어떤 이는 PNP 드라이버의 한 종류로서 실제 하드웨어가 존재하지 않는 상황에서 가상의 하드웨어를 하나 만든 뒤 이를 위한 드라이버를 만들게 되는데, 이것을 레거시 드라이버라고 한다.
또 다른 이는 하드웨어의 존재와 관련 없이 응용프로그램 혹은 서비스 프로그램이 원할 때 메모리에 상주하거나 메모리에서 제거되는 목적으로 사용하는 커널 레벨에서 동작하는 코드를 얻기 위해 드라이버를 만들기도 하는데, 이 드라이버를 지칭하기도 한다.
여기서는 후자의 개념으로 레거시 드라이버를 설명하고자 한다.
내가 보기에는 전자의 경우 가상의 하드웨어라 하더라도 윈도우가 볼 때는 실제 하드웨어가 존재하는 것과 같은 방식으로 드라이버를 운용하려 하기 때문에 엄격하게는 PNP 드라이버라고 부르는 것이 맞다고 생각되기 때문이다.

윈도우는 PNP 관리자와 Power 관리자를 운영하고 있으며, 이들의 영향력에서 벗어나는 드라이버가 바로 레거시 드라이버라고 볼 수 있다.
레거시 드라이버를 작성하는 개발자는 드라이버 코드 내에서 이와 같이 PNP, Power와 관련된 준비를 전혀 할 필요가 없다는 의미가 된다.


